---
title: "Comparative Genomics Southern Flounder"
output:
  html_notebook:
    code_folding: hide
    df_print: paged
    highlight: kate
    theme: flatly
    toc: yes
  html_document:
    toc: yes
---

```{r load libraries, message=FALSE, warning=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

source("lib/libraries.R")
source("lib/ggplot.R")

```

# Merge Family maps

Load family maps

```{r}

FamA <- read.delim("results/FamA.fullmap", 
                   header = TRUE, stringsAsFactors = FALSE, sep = "")

FamA_1 <- read.delim("data/LINKMAP/FamA.fullmap", 
                   header = TRUE, stringsAsFactors = FALSE, sep = "")

FamB <- read.delim("results/FamB.fullmap", 
                   header = TRUE, stringsAsFactors = FALSE, sep = "")

temp <- bind_rows(FamA, FamB)

all_markers <- unique(temp$LOCUS)

```

Each map consists of 24 linkage groups and a total of `r nrow(FamA)` and `r nrow(FamB)` markers for Family A and B, respectively with `r length(temp$LOCUS)-length(all_markers)` markers overlapping between the two family maps.

Use LPmerge to create consensus linkage map by merging linkage maps from Family A and B. LPmerge uses linear programming to minimize the mean absolute error between the consensus and family linkage maps; preserve ordering of the markers in the linkage map using linear inequality constraints. When marker order is inconsisten between maps being merged a minimum set of ordinal constraints is delected to resolve the conflicts.

## Merge maps for LG1:

Merge maps, for maximum interval K = 1 - 100 between bins to indlude in objective function. Creates consensus map bins containing markers from map and the corresponding distance in the consensus map. 

```{r}

LG1_A <- FamA %>%
    filter(LG == 1) %>%
    select(LOCUS, POSITION)

LG1_B <- FamB %>%
    filter(LG == 1) %>%
    select(LOCUS, POSITION)

Maps <- list(LG1_A, LG1_B)

# Start writing to an output file
sink("results/LG1.merge")

# merge
LG1 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

Total error is calculated across each individual map compared to consensus map, as well as mean and standard deviation. Select most appropriate K values based on minimizing the root mean-squared error (RMSE) between the consensus and linkage maps. Further, evaluate consensus map length compared to family maps.

```{r}

# load file
merge_stats <- readLines("results/LG1.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract
```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG1.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG1_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet
```

Choose K = 41.

```{r}

View(LG1[[41]])

LG1_cons <- LG1[[41]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "1")

write.table(LG1_cons, "results/LG1.consensus",
            col.names = TRUE, quote = FALSE)

LG1_cons

```

## Merge maps for LG2:

```{r}

LG2_A <- FamA %>%
    filter(LG == 2) %>%
    select(LOCUS, POSITION)

LG2_B <- FamB %>%
    filter(LG == 5) %>%
    select(LOCUS, POSITION)

Maps <- list(LG2_A, LG2_B)

# Start writing to an output file
sink("results/LG2.merge")

# merge
LG2 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

Load stats for K = 1 - 100.

```{r}

# load file
merge_stats <- readLines("results/LG2.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    separate(temp, into = c("x", "CAT", "RMSE"), sep = " ") %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG2.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet
```

Choose K = 5.

```{r}

View(LG2[[5]])

LG2_cons <- LG2[[5]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "2")

write.table(LG2_cons, "results/LG2.consensus",
            col.names = TRUE, quote = FALSE)

LG2_cons

```

## Merge maps for LG3:

```{r}

LG3_A <- FamA %>%
    filter(LG == 3) %>%
    select(LOCUS, POSITION)

LG3_B <- FamB %>%
    filter(LG == 2) %>%
    select(LOCUS, POSITION)

Maps <- list(LG3_A, LG3_B)

# Start writing to an output file
sink("results/LG3.merge")

# merge
LG3 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG3.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract
```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG3.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 5.

```{r}

View(LG3[[5]])

LG3_cons <- LG3[[5]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "3")

write.table(LG3_cons, "results/LG3.consensus",
            col.names = TRUE, quote = FALSE)

LG3_cons

```

## Merge maps for LG4:

```{r}

LG4_A <- FamA %>%
    filter(LG == 4) %>%
    select(LOCUS, POSITION)

LG4_B <- FamB %>%
    filter(LG == 13) %>%
    select(LOCUS, POSITION)

Maps <- list(LG4_A, LG4_B)

# Start writing to an output file
sink("results/LG4.merge")

# merge
LG4 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG4.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract
```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG4.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 23.

```{r}

View(LG4[[23]])

LG4_cons <- LG4[[23]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "4")

write.table(LG4_cons, "results/LG4.consensus",
            col.names = TRUE, quote = FALSE)

LG4_cons

```

## Merge maps for LG5:

```{r}

LG5_A <- FamA %>%
    filter(LG == 5) %>%
    select(LOCUS, POSITION)

LG5_B <- FamB %>%
    filter(LG == 8) %>%
    select(LOCUS, POSITION)

Maps <- list(LG5_A, LG5_B)

# Start writing to an output file
sink("results/LG5.merge")

# merge
LG5 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG5.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG5.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 74.

```{r}

View(LG5[[74]])

LG5_cons <- LG5[[74]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "5")

write.table(LG5_cons, "results/LG5.consensus",
            col.names = TRUE, quote = FALSE)

LG5_cons

```

## Merge maps for LG6:

```{r}

LG6_A <- FamA %>%
    filter(LG == 6) %>%
    select(LOCUS, POSITION)

LG6_B <- FamB %>%
    filter(LG == 11) %>%
    select(LOCUS, POSITION)

Maps <- list(LG6_A, LG6_B)

# Start writing to an output file
sink("results/LG6.merge")

# merge
LG6 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG6.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG6.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 27.

```{r}

View(LG6[[27]])

LG6_cons <- LG6[[27]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "6")

write.table(LG6_cons, "results/LG6.consensus",
            col.names = TRUE, quote = FALSE)

LG6_cons

```

## Merge maps for LG7:

```{r}

LG7_A <- FamA %>%
    filter(LG == 7) %>%
    select(LOCUS, POSITION)

LG7_B <- FamB %>%
    filter(LG == 3) %>%
    select(LOCUS, POSITION)

Maps <- list(LG7_A, LG7_B)

# Start writing to an output file
sink("results/LG7.merge")

# merge
LG7 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG7.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG7.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 75.

```{r}

View(LG7[[75]])

LG7_cons <- LG7[[75]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "7")

write.table(LG7_cons, "results/LG7.consensus",
            col.names = TRUE, quote = FALSE)

LG7_cons

```

## Merge maps for LG8:

```{r}

LG8_A <- FamA %>%
    filter(LG == 8) %>%
    select(LOCUS, POSITION)

LG8_B <- FamB %>%
    filter(LG == 24) %>%
    select(LOCUS, POSITION)

Maps <- list(LG8_A, LG8_B)

# Start writing to an output file
sink("results/LG8.merge")

# merge
LG8 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG8.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG8.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = RMSE)) +
    geom_histogram(binwidth = 1) +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet


ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 4.

```{r}

View(LG8[[4]])

LG8_cons <- LG8[[4]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "8")

write.table(LG8_cons, "results/LG8.consensus",
            col.names = TRUE, quote = FALSE)

LG8_cons

```

## Merge maps for LG9:

```{r}

LG9_A <- FamA %>%
    filter(LG == 9) %>%
    select(LOCUS, POSITION)

LG9_B <- FamB %>%
    filter(LG == 17) %>%
    select(LOCUS, POSITION)

Maps <- list(LG9_A, LG9_B)

# Start writing to an output file
sink("results/LG9.merge")

# merge
LG9 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG9.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG9.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 41.

```{r}

View(LG9[[41]])

LG9_cons <- LG9[[41]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "9")

write.table(LG9_cons, "results/LG9.consensus",
            col.names = TRUE, quote = FALSE)

LG9_cons

```

## Merge maps for LG10:

```{r}

LG10_A <- FamA %>%
    filter(LG == 10) %>%
    select(LOCUS, POSITION)

LG10_B <- FamB %>%
    filter(LG == 6) %>%
    select(LOCUS, POSITION)

Maps <- list(LG10_A, LG10_B)

# Start writing to an output file
sink("results/LG10.merge")

# merge
LG10 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG10.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract
```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG10.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet
```

Choose K = 82.

```{r}

View(LG10[[82]])

LG10_cons <- LG10[[82]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "10")

write.table(LG10_cons, "results/LG10.consensus",
            col.names = TRUE, quote = FALSE)

LG10_cons

```

## Merge maps for LG11:

```{r}

LG11_A <- FamA %>%
    filter(LG == 11) %>%
    select(LOCUS, POSITION)

LG11_B <- FamB %>%
    filter(LG == 18) %>%
    select(LOCUS, POSITION)

Maps <- list(LG11_A, LG11_B)

# Start writing to an output file
sink("results/LG11.merge")

# merge
LG11 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG11.merge")

```

Markers with constraints that needed to be solved.

```{r}
# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract
```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG11.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet
```

Choose K = 69.

```{r}

View(LG11[[69]])

LG11_cons <- LG11[[69]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "11")

write.table(LG11_cons, "results/LG11.consensus",
            col.names = TRUE, quote = FALSE)

LG11_cons

```

## Merge maps for LG12:

```{r}

LG12_A <- FamA %>%
    filter(LG == 12) %>%
    select(LOCUS, POSITION)

LG12_B <- FamB %>%
    filter(LG == 10) %>%
    select(LOCUS, POSITION)

Maps <- list(LG12_A, LG12_B)

# Start writing to an output file
sink("results/LG12.merge")

# merge
LG12 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG12.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG12.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 64.

```{r}

View(LG1[[64]])

LG12_cons <- LG1[[64]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "12")

write.table(LG12_cons, "results/LG12.consensus",
            col.names = TRUE, quote = FALSE)

LG12_cons

```

## Merge maps for LG13:

```{r}

LG13_A <- FamA %>%
    filter(LG == 13) %>%
    select(LOCUS, POSITION)

LG13_B <- FamB %>%
    filter(LG == 7) %>%
    select(LOCUS, POSITION)

Maps <- list(LG13_A, LG13_B)

# Start writing to an output file
sink("results/LG13.merge")

# merge
LG13 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG13.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG13.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 18.

```{r}

View(LG13[[18]])

LG13_cons <- LG13[[18]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "13")

write.table(LG13_cons, "results/LG13.consensus",
            col.names = TRUE, quote = FALSE)

LG13_cons

```

## Merge maps for LG14:

```{r}

LG14_A <- FamA %>%
    filter(LG == 14) %>%
    select(LOCUS, POSITION)

LG14_B <- FamB %>%
    filter(LG == 4) %>%
    select(LOCUS, POSITION)

Maps <- list(LG14_A, LG14_B)

# Start writing to an output file
sink("results/LG14.merge")

# merge
LG14 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG14.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG14.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 7.

```{r}

View(LG14[[7]])

LG14_cons <- LG14[[7]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "14")

write.table(LG14_cons, "results/LG14.consensus",
            col.names = TRUE, quote = FALSE)

LG14_cons

```

## Merge maps for LG15:

```{r}

LG15_A <- FamA %>%
    filter(LG == 15) %>%
    select(LOCUS, POSITION)

LG15_B <- FamB %>%
    filter(LG == 12) %>%
    select(LOCUS, POSITION)

Maps <- list(LG15_A, LG15_B)

# Start writing to an output file
sink("results/LG15.merge")

# merge
LG15 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG15.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG15.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 2.

```{r}

View(LG15[[2]])

LG15_cons <- LG15[[2]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "15")

write.table(LG15_cons, "results/LG15.consensus",
            col.names = TRUE, quote = FALSE)

LG15_cons

```

## Merge maps for LG16:

```{r}

LG16_A <- FamA %>%
    filter(LG == 16) %>%
    select(LOCUS, POSITION)

LG16_B <- FamB %>%
    filter(LG == 9) %>%
    select(LOCUS, POSITION)

Maps <- list(LG16_A, LG16_B)

# Start writing to an output file
sink("results/LG16.merge")

# merge
LG16 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG16.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG16.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 5.

```{r}

View(LG16[[5]])

LG16_cons <- LG16[[5]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "16")

write.table(LG16_cons, "results/LG16.consensus",
            col.names = TRUE, quote = FALSE)

LG16_cons

```

## Merge maps for LG17:

```{r}

LG17_A <- FamA %>%
    filter(LG == 17) %>%
    select(LOCUS, POSITION)

LG17_B <- FamB %>%
    filter(LG == 15) %>%
    select(LOCUS, POSITION)

Maps <- list(LG17_A, LG17_B)

# Start writing to an output file
sink("results/LG17.merge")

# merge
LG17 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG17.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG17.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 18.

```{r}

View(LG17[[18]])

LG17_cons <- LG17[[18]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "17")

write.table(LG17_cons, "results/LG17.consensus",
            col.names = TRUE, quote = FALSE)

LG17_cons

```

## Merge maps for LG18:

```{r}

LG18_A <- FamA %>%
    filter(LG == 18) %>%
    select(LOCUS, POSITION)

LG18_B <- FamB %>%
    filter(LG == 14) %>%
    select(LOCUS, POSITION)

Maps <- list(LG18_A, LG18_B)

# Start writing to an output file
sink("results/LG18.merge")

# merge
LG18 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG18.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG18.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 79.

```{r}

View(LG18[[79]])

LG18_cons <- LG18[[79]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "18")

write.table(LG18_cons, "results/LG18.consensus",
            col.names = TRUE, quote = FALSE)

LG18_cons

```

## Merge maps for LG19:

```{r}

LG19_A <- FamA %>%
    filter(LG == 19) %>%
    select(LOCUS, POSITION)

LG19_B <- FamB %>%
    filter(LG == 16) %>%
    select(LOCUS, POSITION)

Maps <- list(LG19_A, LG19_B)

# Start writing to an output file
sink("results/LG19.merge")

# merge
LG19 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG19.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG19.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 63.

```{r}

View(LG19[[63]])

LG19_cons <- LG19[[63]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "19")

write.table(LG19_cons, "results/LG19.consensus",
            col.names = TRUE, quote = FALSE)

LG19_cons

```

## Merge maps for LG20:

```{r}

LG20_A <- FamA %>%
    filter(LG == 20) %>%
    select(LOCUS, POSITION)

LG20_B <- FamB %>%
    filter(LG == 19) %>%
    select(LOCUS, POSITION)

Maps <- list(LG20_A, LG20_B)

# Start writing to an output file
sink("results/LG20.merge")

# merge
LG20 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG20.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG20.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 59.

```{r}

View(LG20[[59]])

LG20_cons <- LG20[[59]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "20")

write.table(LG20_cons, "results/LG20.consensus",
            col.names = TRUE, quote = FALSE)

LG20_cons

```

## Merge maps for LG21:

```{r}

LG21_A <- FamA %>%
    filter(LG == 21) %>%
    select(LOCUS, POSITION)

LG21_B <- FamB %>%
    filter(LG == 21) %>%
    select(LOCUS, POSITION)

Maps <- list(LG21_A, LG21_B)

# Start writing to an output file
sink("results/LG21.merge")

# merge
LG21 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG21.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG21.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 53.

```{r}

View(LG21[[53]])

LG21_cons <- LG21[[53]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "21")

write.table(LG21_cons, "results/LG21.consensus",
            col.names = TRUE, quote = FALSE)

LG21_cons

```

## Merge maps for LG22:

```{r}

LG22_A <- FamA %>%
    filter(LG == 22) %>%
    select(LOCUS, POSITION)

LG22_B <- FamB %>%
    filter(LG == 23) %>%
    select(LOCUS, POSITION)

Maps <- list(LG22_A, LG22_B)

# Start writing to an output file
sink("results/LG22.merge")

# merge
LG22 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG22.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG22.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 7.

```{r}

View(LG22[[7]])

LG22_cons <- LG22[[7]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "22")

write.table(LG22_cons, "results/LG22.consensus",
            col.names = TRUE, quote = FALSE)

LG22_cons

```

## Merge maps for LG23:

```{r}

LG23_A <- FamA %>%
    filter(LG == 23) %>%
    select(LOCUS, POSITION)

LG23_B <- FamB %>%
    filter(LG == 20) %>%
    select(LOCUS, POSITION)

Maps <- list(LG23_A, LG23_B)

# Start writing to an output file
sink("results/LG23.merge")

# merge
LG23 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG23.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}
# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))
# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG23.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet
```

Choose K = 63.

```{r}

View(LG23[[63]])

LG23_cons <- LG23[[63]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "23")

write.table(LG23_cons, "results/LG23.consensus",
            col.names = TRUE, quote = FALSE)

LG23_cons

```

## Merge maps for LG24:

```{r}

LG24_A <- FamA %>%
    filter(LG == 24) %>%
    select(LOCUS, POSITION)

LG24_B <- FamB %>%
    filter(LG == 22) %>%
    select(LOCUS, POSITION)

Maps <- list(LG24_A, LG24_B)

# Start writing to an output file
sink("results/LG24.merge")

# merge
LG24 <- LPmerge(Maps, max.interval = 1:100, weights = NULL)

# Stop writing to the file
sink()

```

```{r}

# load file
merge_stats <- readLines("results/LG24.merge")

```

Markers with constraints that needed to be solved.

```{r}

# markers with constraints
map_extract <- as.data.frame(grep("Map", merge_stats, value = TRUE)) %>%
  rename(temp = `grep("Map", merge_stats, value = TRUE)`) %>%
  separate(temp, into = c("x", "y"), sep = "]") %>%
  separate(y, into = c("MAP", "LOCUS"), sep = ":") %>%
    select(MAP, LOCUS) %>%
    mutate(MAP = str_replace(MAP, "\"", " ")) %>%
    mutate(LOCUS = str_replace(LOCUS, "\"", " ")) %>%
    arrange(MAP)

map_extract

```

View RMSE values for Map1, 2, mean and sd.

```{r, message=FALSE, warning=FALSE}

# extract all RMSE values
map_rmse <- as.data.frame(grep("]" , merge_stats, invert = TRUE, value = TRUE)) %>%
    rename(temp = `grep("]", merge_stats, invert = TRUE, value = TRUE)`) %>%
    mutate(temp = str_trim(temp)) %>%
    droplevels()

# RMSE values for mean
rmse_mean <- map_rmse %>%
    filter(grepl("mean", temp)) %>%
    mutate(temp = str_replace(temp, "3", " ")) %>%
    mutate(RMSE = parse_number(temp)) %>%
    mutate(CAT = "mean") %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values for SD
rmse_sd <- map_rmse %>%
    filter(grepl("sd", temp)) %>%
    separate(temp, into = c("x", "y"), sep = 4) %>%
    separate(y, into = c("CAT", "RMSE"), sep = 3) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE) %>%
    mutate(K = c(1:100))

# RMSE values map 1 & 2
rmse_map <- map_rmse %>%
    filter(!grepl("sd | mean", temp)) %>%
    filter(!grepl("map", temp)) %>%
    separate(temp, into = c("CAT", "y"), sep = c(1)) %>%
    separate(y, into = c("y", "RMSE"), sep = -6) %>%
    mutate(RMSE = parse_number(RMSE)) %>%
    mutate(CAT = str_trim(CAT)) %>%
    select(CAT, RMSE)

rmse_map1 <- rmse_map %>%
    filter(CAT == 1) %>%
    mutate(K = c(1:100))

rmse_map2 <- rmse_map %>%
    filter(CAT == 2) %>%
    mutate(K = c(1:100))

# create data frame with all rmse values
LG_merge <- bind_rows(rmse_mean, rmse_sd)
LG_merge <- bind_rows(LG_merge, rmse_map1)
LG_merge <- bind_rows(LG_merge, rmse_map2)

write.table(LG_merge, "results/LG24.merge.sum",
            col.names = TRUE, quote = FALSE)

# plot stats
ggplot(LG_merge, aes(x = K, y = RMSE)) +
    geom_point() +
    facet_grid(CAT ~ ., scales = "free") +
    theme_facet

```

Choose K = 4.

```{r}

View(LG24[[4]])

LG24_cons <- LG24[[4]] %>%
    rename(LOCUS = marker,
           POS = consensus,
           POSfamA = X1,
           POSfamB = X2) %>%
    mutate(LG = "24")

write.table(LG24_cons, "results/LG24.consensus",
            col.names = TRUE, quote = FALSE)

LG24_cons

```
